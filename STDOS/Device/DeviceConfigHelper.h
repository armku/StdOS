#ifndef _SERIALPORTCONFIG_H
#define _SERIALPORTCONFIG_H
#include <stdint.h>
#include "Platform\Pin.h"
#include "Port.h"
#include "Core\Queue.h"

#define USECOM1
#define USECOM2
#define USECOM3
#define USECOM4
#define USECOM5

#if defined USECOM1

#define COM1TXDMAFLAG  //串口1DMA发送

#if defined COM1TXDMAFLAG
#else
#define COM1SENDINTFLAG	//串口1中断发送
#endif

#define COM1RXDMAFLAG  //串口1DMA接收
#define COM1RCVIDLEINTFLAG	//串口1空闲中断接收
#endif

#if defined USECOM2
#define COM2TXDMAFLAG  //串口2DMA发送
#if defined COM2TXDMAFLAG
#else
#define COM2SENDINTFLAG	//串口2中断发送
#endif

#define COM2RXDMAFLAG  //串口2DMA接收
#define COM2RCVIDLEINTFLAG	//串口2空闲中断接收
#endif

#if defined USECOM3
#define COM3TXDMAFLAG  //串口3DMA发送
#if defined COM3TXDMAFLAG
#else
#define COM3SENDINTFLAG	//串口3中断发送
#endif


#define COM3RXDMAFLAG  //串口3DMA接收
#define COM3RCVIDLEINTFLAG	//串口3空闲中断接收
#endif

#if defined USECOM4
#define COM4TXDMAFLAG  //串口4DMA发送
#if defined COM4TXDMAFLAG
#else
#define COM4SENDINTFLAG	//串口4中断发送
#endif


#define COM4RXDMAFLAG  //串口4DMA接收
#define COM4RCVIDLEINTFLAG	//串口4空闲中断接收
#endif

#if defined USECOM5
#define COM5TXDMAFLAG  //串口5DMA发送
#if defined COM5TXDMAFLAG
#else
#define COM5SENDINTFLAG	//串口5中断发送
#endif
#define COM5RXDMAFLAG  //串口5DMA接收
#define COM5RCVIDLEINTFLAG	//串口5空闲中断接收
#endif

typedef enum
{
	Rising = 0x01,	// 上升沿
	Falling = 0x02,	// 下降沿
	Both = 0x03	// 上升下降沿
}Trigger;

class DeviceConfigCenter
{
public:
	//中断
	static void SetEXIT(int pinIndex, bool enable, Trigger trigger = Both);
	static void InputPort_OpenEXTI(Pin pin, Trigger trigger = Both);

	static Func PExit0;
	static Func PExit1;
	static Func PExit2;
	static Func PExit3;
	static Func PExit4;
	static Func PExit5;
	static Func PExit6;
	static Func PExit7;
	static Func PExit8;
	static Func PExit9;
	static Func PExit10;
	static Func PExit11;
	static Func PExit12;
	static Func PExit13;
	static Func PExit14;
	static Func PExit15;

	//串口	
	static void ConfigCom(COM com, int baudRate);
	static void ComChgBaudRate(COM com, int baudRate);//改变波特率
	static void com1send();
	static void com2send();
	static void com3send();
	static void com4send();
	static void com5send();
	static void com1send(Buffer& bs);
	static void com2send(Buffer& bs);
	static void com3send(Buffer& bs);
	static void com4send(Buffer& bs);
	static void com5send(Buffer& bs);
	static void comSend(COM com, Buffer bs);//发送数据
	static OutputPort *pCOM1Rx485;
	static OutputPort *pCOM2Rx485;
	static OutputPort *pCOM3Rx485;
	static OutputPort *pCOM4Rx485;
	static OutputPort *pCOM5Rx485;

	static Func PRcvCOM1;
	static Func PRcvCOM2;
	static Func PRcvCOM3;
	static Func PRcvCOM4;
	static Func PRcvCOM5;
			
	static int RcvLastTimeCOM1;//串口1最后接收数据时间
	static int RcvLastTimeCOM2;//串口2最后接收数据时间
	static int RcvLastTimeCOM3;//串口3最后接收数据时间
	static int RcvLastTimeCOM4;//串口4最后接收数据时间
	static int RcvLastTimeCOM5;//串口5最后接收数据时间

	static int BUFLEN_TX1;	//串口1发送缓冲区长度
	static int BUFLEN_RX1;	//串口1接收缓冲区长度
	static int BUFLEN_TX2;	//串口2发送缓冲区长度
	static int BUFLEN_RX2;	//串口2接收缓冲区长度
	static int BUFLEN_TX3;	//串口3发送缓冲区长度
	static int BUFLEN_RX3;	//串口3接收缓冲区长度
	static int BUFLEN_TX4;	//串口4发送缓冲区长度
	static int BUFLEN_RX4;	//串口4接收缓冲区长度
	static int BUFLEN_TX5;	//串口5发送缓冲区长度
	static int BUFLEN_RX5;	//串口5接收缓冲区长度

	static int FLAG_TX1EN;	//串口1可以发送
	static int FLAG_TX2EN;	//串口2可以发送
	static int FLAG_TX3EN;	//串口3可以发送
	static int FLAG_TX4EN;	//串口4可以发送
	static int FLAG_TX5EN;	//串口5可以发送
	//定时器
	static void TimeTickInit();//系统用定时器初始化
	static void TimerConfig(TIMER tim, int interval, int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);//定时器配置
	static void Timer0Config(int interval);//定时器配置
	static void Timer1Config(int interval);//定时器配置
	static void Timer2Config(int interval);//定时器配置
	static void Timer3Config(int interval);//定时器配置
	static void Timer4Config(int interval);//定时器配置
	static void Timer5Config(int interval);//定时器配置
	static void Timer6Config(int interval);//定时器配置
	static void Timer7Config(int interval);//定时器配置
	static void Timer8Config(int interval);//定时器配置
	static void TimerConfigNvic(TIMER tim, int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer0ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer1ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer2ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer3ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer4ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer5ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer6ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer7ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);
	static void Timer8ConfigNvic(int NVIC_PriorityGroup = 0, int NVIC_IRQChannelPreemptionPriority = 0, int NVIC_IRQChannelSubPriorit = 3);

	static Func PTim2Update;
	static Func PTim3Update;
	static Func PTim4Update;
	static Func PTim5Update;
	static Func PTim6Update;
	static Func PTim7Update;
	static Func PTim8Update;
	//系统
	static int CurrentTick();
	static uint32_t CurrentTicks1();

private:
	//中断

	//串口
	static void configCOM1(int baudRate);
	static void configCOM2(int baudRate);
	static void configCOM3(int baudRate);
	static void configCOM4(int baudRate);
	static void configCOM5(int baudRate);
	static void Com1ChgBaudRate(int baudRate);
	static void Com2ChgBaudRate(int baudRate);
	static void Com3ChgBaudRate(int baudRate);
	static void Com4ChgBaudRate(int baudRate);
	static void Com5ChgBaudRate(int baudRate);
	static void SerialPort_GetPins(Pin *txPin, Pin *rxPin, COM index, bool Remap = false);

	static void Com1RcvRoutin(void *param);//串口1接收判断
	static void Com2RcvRoutin(void *param);//串口1接收判断
	static void Com3RcvRoutin(void *param);//串口1接收判断
	static void Com4RcvRoutin(void *param);//串口1接收判断
	static void Com5RcvRoutin(void *param);//串口1接收判断
	//定时器
};
#ifdef __cplusplus
extern "C" {
#endif	
#if defined USECOM1
	extern Queue	Txx1;
	extern Queue	Rxx1;
#endif // USECOM1

#if defined USECOM2
	extern Queue	Txx2;
	extern Queue	Rxx2;
#endif // USECOM2

#if defined USECOM3
	extern Queue	Txx3;
	extern Queue	Rxx3;
#endif // USECOM3

#if defined USECOM4
	extern Queue	Txx4;
	extern Queue	Rxx4;
#endif // USECOM4

#if defined USECOM5
	extern Queue	Txx5;
	extern Queue	Rxx5;
#endif // USECOM5

#ifdef __cplusplus
}
#endif

#endif // !_SERIALPORTCONFIG_H
